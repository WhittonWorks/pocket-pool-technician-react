{
  "id": "jandy-jxiq-v1",
  "brand": "Jandy",
  "equipmentType": "Heaters",
  "model": "JXiQ",
  "title": "Jandy JXiQ Heater — Guided Troubleshooting",
  "start": "enter_model",

  "nodes": {
    "enter_model": {
      "id": "enter_model",
      "text": "Enter the JXiQ model number.\n\nValid examples:\n- JXI200N\n- JXI260NK\n- JXI400NK (400k BTU, Natural Gas, VersaFlo)\n\nFormat:\n- Starts with JXI\n- BTU: 200 / 260 / 400\n- Fuel: N = Natural Gas, P = Propane\n- Optional: C = ASME, K = VersaFlo, S = ASME CuNi\n\nExample: **JXI400NK**",
      "input": "text",
      "logic": [
        { "if": "/^JXI(200|260|400)[NP][CKS]?$/i.test(value)", "goto": "enter_serial" }
      ],
      "default": "invalid_model"
    },

    "invalid_model": {
      "id": "invalid_model",
      "text": "❌ Invalid model number.\nExpected format:\nJXI + BTU (200/260/400) + Fuel (N/P) + Optional (C/K/S).",
      "input": "info",
      "pass": "enter_model"
    },

    "enter_serial": {
      "id": "enter_serial",
      "text": "Enter the full serial number from the JXiQ label.\n\nCorrect format:\n- 20 characters\n- First 2 = letters A–Z\n- Remaining 18 = letters or digits\n\nExample: **ATEC02050307240489**",
      "input": "text",
      "logic": [
        { "if": "/^[A-Z]{2}[A-Z0-9]{18}$/i.test(value)", "goto": "enter_voltage" }
      ],
      "default": "invalid_serial"
    },

    "invalid_serial": {
      "id": "invalid_serial",
      "text": "❌ Invalid serial number.\nExpected: 20 characters, first 2 letters, rest alphanumeric.",
      "input": "info",
      "pass": "enter_serial"
    },

    "enter_voltage": {
      "id": "enter_voltage",
      "text": "Confirm measured input voltage to the JXiQ heater.",
      "input": "choice",
      "choices": {
        "120 V": "power_check_120",
        "240 V": "power_check_240"
      }
    },

    "power_check_120": {
      "id": "power_check_120",
      "text": "Measure voltage at input terminals (Black → Red).\nExpected: 110–126 VAC.",
      "input": "number",
      "unit": "VAC",
      "range": [110, 126],
      "pass": "transformer_check",
      "fail": "fix_power"
    },

    "power_check_240": {
      "id": "power_check_240",
      "text": "Measure voltage at input terminals (Black → Red).\nExpected: 220–252 VAC.",
      "input": "number",
      "unit": "VAC",
      "range": [220, 252],
      "pass": "transformer_check",
      "fail": "fix_power"
    },

    "fix_power": {
      "id": "fix_power",
      "text": "Correct incoming power wiring, breaker, or supply voltage before continuing.",
      "input": "info",
      "terminal": true
    },

    "transformer_check": {
      "id": "transformer_check",
      "text": "Verify 24 VAC transformer output (Red → Yellow).\nExpected: 22–26 VAC.",
      "input": "number",
      "unit": "VAC",
      "range": [22, 26],
      "pass": "fuse_check",
      "fail": "replace_transformer"
    },

    "replace_transformer": {
      "id": "replace_transformer",
      "text": "Transformer output low — replace transformer (P/N R0456301).",
      "input": "info",
      "terminal": true
    },

    "fuse_check": {
      "id": "fuse_check",
      "text": "Check the 3A low-voltage fuse on the control board for continuity.",
      "input": "yesno",
      "pass": "pressure_switch_check",
      "fail": "replace_fuse"
    },

    "replace_fuse": {
      "id": "replace_fuse",
      "text": "3A fuse open — replace fuse and verify no shorts before restarting.",
      "input": "info",
      "terminal": true
    },

    "pressure_switch_check": {
      "id": "pressure_switch_check",
      "text": "Verify the water pressure switch closes with pump on.\nMeasure 24 VAC across pressure switch.\nExpected: 22–26 VAC.",
      "input": "number",
      "unit": "VAC",
      "range": [22, 26],
      "pass": "blower_check",
      "fail": "replace_pressure_switch"
    },

    "replace_pressure_switch": {
      "id": "replace_pressure_switch",
      "text": "Pressure switch not closing — replace pressure switch (P/N R0457001).",
      "input": "info",
      "terminal": true
    },

    "blower_check": {
      "id": "blower_check",
      "text": "Does the blower motor start during pre-purge?",
      "input": "yesno",
      "pass": "igniter_check",
      "fail": "blower_capacitor_check"
    },

    "blower_capacitor_check": {
      "id": "blower_capacitor_check",
      "text": "Measure blower capacitor (P/N R0614500).\nExpected: 8 µF ± 5%.",
      "input": "number",
      "unit": "µF",
      "range": [7.6, 8.4],
      "pass": "blower_failed",
      "fail": "replace_capacitor"
    },

    "replace_capacitor": {
      "id": "replace_capacitor",
      "text": "Capacitor out of spec — replace run capacitor (P/N R0614500).",
      "input": "info",
      "terminal": true
    },

    "blower_failed": {
      "id": "blower_failed",
      "text": "Capacitor good but blower still not running — replace blower assembly (P/N R0591100).",
      "input": "info",
      "terminal": true
    },

    "igniter_check": {
      "id": "igniter_check",
      "text": "Does the igniter glow during ignition?",
      "input": "yesno",
      "pass": "gas_valve_check",
      "fail": "igniter_voltage_check"
    },

    "igniter_voltage_check": {
      "id": "igniter_voltage_check",
      "text": "Measure igniter voltage at terminals K → I.\nExpected: 105–130 VAC.",
      "input": "number",
      "unit": "VAC",
      "range": [105, 130],
      "pass": "igniter_continuity_check",
      "fail": "replace_icb"
    },

    "replace_icb": {
      "id": "replace_icb",
      "text": "Ignition control board not sending voltage — replace ICB (P/N R0451800).",
      "input": "info",
      "terminal": true
    },

    "igniter_continuity_check": {
      "id": "igniter_continuity_check",
      "text": "Check igniter continuity (power off).\nExpected: 40–75 Ω.",
      "input": "number",
      "unit": "Ω",
      "range": [40, 75],
      "pass": "gas_valve_check",
      "fail": "replace_igniter"
    },

    "replace_igniter": {
      "id": "replace_igniter",
      "text": "Replace Hot Surface Igniter (P/N R0457502).",
      "input": "info",
      "terminal": true
    },

    "gas_valve_check": {
      "id": "gas_valve_check",
      "text": "Measure 24 VAC at the gas valve during ignition.\nExpected: 22–26 VAC.",
      "input": "number",
      "unit": "VAC",
      "range": [22, 26],
      "pass": "flame_check",
      "fail": "replace_icb"
    },

    "flame_check": {
      "id": "flame_check",
      "text": "Do burners ignite and stay lit > 7 seconds?",
      "input": "yesno",
      "pass": "flame_signal_check",
      "fail": "flame_sensor_check"
    },

    "flame_signal_check": {
      "id": "flame_signal_check",
      "text": "Measure flame rectification current.\nExpected ≥ 1.5 µA DC.",
      "input": "number",
      "unit": "µA DC",
      "range": [1.5, 10],
      "pass": "rs485_comm_check",
      "fail": "replace_flame_sensor"
    },

    "replace_flame_sensor": {
      "id": "replace_flame_sensor",
      "text": "Flame signal weak — clean or replace flame sensor (P/N R0452502).",
      "input": "info",
      "terminal": true
    },

    "flame_sensor_check": {
      "id": "flame_sensor_check",
      "text": "No flame detected — check igniter, gas valve, ground, or manifold pressure.",
      "input": "info",
      "terminal": true
    },

    "rs485_comm_check": {
      "id": "rs485_comm_check",
      "text": "Verify RS-485 communication between JXiQ and automation.",
      "input": "yesno",
      "pass": "versa_flo_check",
      "fail": "check_comms_wiring"
    },

    "check_comms_wiring": {
      "id": "check_comms_wiring",
      "text": "Check RS-485 wiring for polarity, continuity, and shorts.",
      "input": "info",
      "terminal": true
    },

    "versa_flo_check": {
      "id": "versa_flo_check",
      "text": "If equipped, verify Versaflo actuator movement.",
      "input": "yesno",
      "pass": "temp_sensor_check",
      "fail": "versa_flo_service"
    },

    "versa_flo_service": {
      "id": "versa_flo_service",
      "text": "VersaFlo not responding — inspect actuator harness and replace if needed.",
      "input": "info",
      "terminal": true
    },

    "temp_sensor_check": {
      "id": "temp_sensor_check",
      "text": "Measure temperature sensor resistance.\nExpected: 10 kΩ at 77°F (range 9–11 kΩ).",
      "input": "number",
      "unit": "kΩ",
      "range": [9, 11],
      "pass": "control_board_check",
      "fail": "replace_temp_sensor"
    },

    "replace_temp_sensor": {
      "id": "replace_temp_sensor",
      "text": "Replace temperature sensor (P/N R0592600).",
      "input": "info",
      "terminal": true
    },

    "control_board_check": {
      "id": "control_board_check",
      "text": "Confirm main board LED status and 5 VDC logic supply present.",
      "input": "yesno",
      "pass": "success",
      "fail": "replace_main_board"
    },

    "replace_main_board": {
      "id": "replace_main_board",
      "text": "Replace main board (P/N R0639400).",
      "input": "info",
      "terminal": true
    },

    "success": {
      "id": "success",
      "text": "✅ JXiQ heater operating normally.",
      "input": "info",
      "terminal": true,
      "success": true
    }
  }
}